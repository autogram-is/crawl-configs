{
  queries: {
    summary: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "Summary of crawled URLs",
      },
      collection: 'resources',
      aggregates: [
        { name: 'Site', path: 'parsed.hostname', function: 'collect' },
        { name: 'Type', path: 'mime', function: 'collect' },
        { name: 'Speed', path: 'timing.duration', function: 'average' }
      ],
      filters: [
        { path: 'Code', document: false, eq: 200 }
      ],
      count: 'total',
      sorts: [{ name: 'total', direction: 'desc' }, { name: 'Site', direction: 'desc' }],
    },

    pages: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "HTML pages checked or crawled by Spidergram",
      },
      collection: 'resources',
      subqueries: [
        {
          name: 'inlinks',
          function: 'unique',
          query: {
            collection: 'responds_with',
            document: 'rw',
            filters: [{ path: '_to', eq: 'item._id', value: 'dynamic' }],
            subqueries: [
              {
                collection: 'links_to',
                document: 'lt',
                filters: [{ path: '_to', eq: 'rw._from', value: 'dynamic' }],
                subqueries: [
                  {
                    collection: 'resources',
                    document: 'source',
                    filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
                  },
                ],
              }
            ],
            return: [{ path: 'url', document: 'source' }],
          },
        },
        {
          name: 'outlinks',
          function: 'unique',
          query: {
            collection: 'links_to',
            document: 'lt',
            filters: [{ path: '_from', eq: 'item._id', value: 'dynamic' }],
            subqueries: [
              {
                collection: 'unique_urls',
                document: 'target',
                filters: [{ path: '_id', eq: 'lt._to', value: 'dynamic' }],
              }
            ],
            return: [{ path: 'url', document: 'target' }],
          },
        },
      ],
      filters: [
        { name: "code", eq: 200 },
        { name: "mime", eq: 'text/html' },
      ],
      return: [
        { name: 'Site', path: 'site' },
        { name: 'Path', path: 'parsed.pathname' },
        { name: 'Query', path: 'parsed.search' },

        // Random stuff
        { name: 'CMS', path: 'tech.CMS[0]' },

        // Content analysis
        { name: 'Size', path: 'size' },

        { name: 'Title', path: 'content.title' },
        { name: 'Description', path: 'content.description' },
        { name: 'Date', path: 'content.date' },
        { name: 'Words', path: 'content.readability.words' },
        { name: 'Readability', path: 'content.readability.score' },
        
        // Detected data
        { name: 'Cookies', path: 'cookies', function: 'length' },
        { name: 'Technologies', path: 'tech', function: 'length' },
        { name: 'A11y Errors', path: 'accessibility.totalViolations' },
        { name: 'Opengraph', path: 'data.meta.og', function: 'is_object' },
        { name: 'Twitter', path: 'data.meta.twitter', function: 'is_object' },
        { name: 'SchemaOrg', path: 'data.schemaOrg', function: 'is_object' },
                
        // Pagespeed data
        { name: 'Load Time', path: 'timing.duration' },
        
        
        // Inlink/outlink counts
        { name: 'Inlinks', path: 'inlinks', function: 'length', document: false },      
        { name: 'Outlinks', path: 'outlinks', function: 'length', document: false },        
      ],
      sorts: [{ path: 'url', direction: 'asc' }],
    },

    pdfs: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "PDF files crawled by Spidergram",
      },
      collection: 'resources',
      subqueries: [
        {
          name: 'inlinks',
          function: 'unique',
          query: {
            collection: 'responds_with',
            document: 'rw',
            filters: [{ path: '_to', eq: 'item._id', value: 'dynamic' }],
            subqueries: [
              {
                collection: 'links_to',
                document: 'lt',
                filters: [{ path: '_to', eq: 'rw._from', value: 'dynamic' }],
                subqueries: [
                  {
                    collection: 'resources',
                    document: 'source',
                    filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
                  },
                ],
              }
            ],
            return: [{ path: 'url', document: 'source' }],
          },
        },
      ],
      filters: [
        { name: "code", eq: 200 },
        { name: "mime", eq: 'application/pdf' },
      ],
      return: [
        { name: 'Site', path: 'parsed.hostname' },
        { name: 'Path', path: 'parsed.pathname' },
        
        // Content analysis
        { name: 'Size', path: 'size' },
        { name: 'Title', path: 'content.title' },
        { name: 'Date', path: 'content.date', function: '' },
        { name: 'Pages', path: 'data.pages' },
        { name: 'Words', path: 'content.readability.words' },
        { name: 'Readability', path: 'content.readability.score' },
        
        // Inlink/outlink counts
        { name: 'Inlinks', path: 'inlinks', function: 'length', document: false },      
        { name: 'Outlinks', path: 'content.urls', function: 'length' },        
      ],
      sorts: [{ path: 'url', direction: 'asc' }],
    },

    word_docs: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "MS Word files crawled by Spidergram",
      },
      collection: 'resources',
      subqueries: [
        {
          name: 'inlinks',
          function: 'unique',
          query: {
            collection: 'responds_with',
            document: 'rw',
            filters: [{ path: '_to', eq: 'item._id', value: 'dynamic' }],
            subqueries: [
              {
                collection: 'links_to',
                document: 'lt',
                filters: [{ path: '_to', eq: 'rw._from', value: 'dynamic' }],
                subqueries: [
                  {
                    collection: 'resources',
                    document: 'source',
                    filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
                  },
                ],
              }
            ],
            return: [{ path: 'url', document: 'source' }],
          },
        },
      ],
      filters: [
        { name: "code", eq: 200 },
        { name: "mime", eq: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' },
      ],
      return: [
        { name: 'Site', path: 'parsed.hostname' },
        { name: 'Path', path: 'parsed.pathname' },
        
        // Content analysis
        { name: 'Size', path: 'size' },
        { name: 'Title', path: 'content.title' },
        { name: 'Template', path: 'data.template' },
        { name: 'Created', path: 'data.created', function: '' },
        { name: 'Modified', path: 'data.modified', function: '' },
        { name: 'CreatedBy', path: 'data.createdBy' },
        { name: 'ModifiedBy', path: 'data.modifiedBy' },

        { name: 'Pages', path: 'data.pages' },
        { name: 'Words', path: 'content.readability.words' },
        { name: 'Readability', path: 'content.readability.score' },
        
        // Inlink/outlink counts
        { name: 'Inlinks', path: 'inlinks', function: 'length', document: false },      
      ],
      sorts: [{ path: 'url', direction: 'asc' }],
    },

    images: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "Downloadable images crawled by Spidergram",
      },
      collection: 'resources',
      subqueries: [{
        name: 'inlinks',
        function: 'unique',
        query: {
          collection: 'responds_with',
          document: 'rw',
          filters: [{ path: '_to', eq: 'item._id', value: 'dynamic' }],
          subqueries: [
            {
              collection: 'links_to',
              document: 'lt',
              filters: [{ path: '_to', eq: 'rw._from', value: 'dynamic' }],
              subqueries: [
                {
                  collection: 'resources',
                  document: 'source',
                  filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
                },
              ],
            }
          ],
          return: [{ path: 'url', document: 'source' }],
        },
      }],
      filters: [
        { name: "code", eq: 200 },
        { name: "mime", contains: 'image/%', type: 'string' },
      ],
      sorts: [{ path: 'url', direction: 'asc' }],
      return: [
        { name: 'Site', path: 'parsed.hostname' },
        { name: 'URL', path: 'parsed.pathname' },
        { name: 'Mime', path: 'mime' },
        { name: 'Size', path: 'size' },
        { name: 'Height', path: 'data.height' },
        { name: 'Width', path: 'data.width' },
        { name: 'Artist', path: 'data.Artist' },
        { name: 'Description', path: 'data.ImageDescription' },
        { name: 'Created', path: 'data.CreateDate' },
        { name: 'Modified', path: 'data.ModifyDate' },
        { name: 'Software', path: 'data.Software' },
        { name: 'Inlinks', path: 'inlinks', function: 'length', document: false },
      ]
    },

    errors: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "Resources that returned errors when visited",
      },
      collection: 'resources',
      subqueries: [{
        name: 'inlinks',
        function: 'unique',
        query: {
          collection: 'responds_with',
          document: 'rw',
          filters: [{ path: '_to', eq: 'item._id', value: 'dynamic' }],
          subqueries: [
            {
              collection: 'links_to',
              document: 'lt',
              filters: [{ path: '_to', eq: 'rw._from', value: 'dynamic' }],
              subqueries: [
                {
                  collection: 'resources',
                  document: 'source',
                  filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
                },
              ],
            }
          ],
          return: [{ path: 'url', document: 'source' }],
        },
      }],
      filters: [
        { name: "code", eq: 200, negate: true }
      ],
      sorts: [{ path: 'inlinks', document: false, direction: 'desc', function: 'length' }],
      return: [
        { name: 'URL', path: 'url' },
        { name: 'Code', path: 'code' },
        { name: 'Message', path: 'message' },
        { name: 'Inlinks', path: 'inlinks', function: 'length', document: false },
      ]
    },

    links: {
      metadata: {
        source: 'Core',
        category: 'core',
        description: "Links to other sites",
      },
      collection: 'unique_urls',
      document: 'target',
      subqueries: [
        {
          collection: 'links_to',
          document: 'lt',
          filters: [{ path: '_to', eq: 'target._id', value: 'dynamic' }],
          subqueries: [
            {
              collection: 'resources',
              document: 'source',
              filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
            },
          ],
        },
      ],
      filters: [
        { path: "parsed.domain", eq: 'source.parsed.domain', negate: true, value: 'dynamic' }
      ],
      return: [
        { name: 'Source URL', path: 'parsed.href', 'document': 'source' },
        { name: 'Target URL', path: 'parsed.href', 'document': 'target' },
        { name: 'Link Text', path: 'text', 'document': 'lt' },
        { name: 'Region', path: 'region', 'document': 'lt' },
      ]
    },

    inlinks: {
      metadata: {
        source: 'Spidergram Core',
        category: 'core',
        description: "Internal links within the site",
      },
      collection: 'resources',
      document: 'target',
      subqueries: [
        {
          collection: 'responds_with',
          document: 'rw',
          filters: [{ path: '_to', eq: 'target._id', value: 'dynamic' }],
          subqueries: [
            {
              collection: 'links_to',
              document: 'lt',
              filters: [{ path: '_to', eq: 'rw._from', value: 'dynamic' }],
              subqueries: [
                {
                  collection: 'resources',
                  document: 'source',
                  filters: [{ path: '_id', eq: 'lt._from', value: 'dynamic' }],
                },
              ],
            }
          ],
        },
      ],
      return: [
        { name: 'Source URL', path: 'parsed.href', 'document': 'source' },
        { name: 'Target URL', path: 'parsed.href', 'document': 'target' },
        { name: 'Link Text', path: 'text', 'document': 'lt' },
        { name: 'Region', path: 'region', 'document': 'lt' },
      ]
    },
  },
}