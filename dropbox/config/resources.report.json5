{
  queries: {
    dropbox_resources: {
      document: "resource",
      metadata: { category: "dropbox", description: "English resource pages" },
      collection: "resources",
      subqueries: [{
        name: "inlinks",
        function: "unique",
        query: {
          collection: "responds_with",
          document: "rw",
          filters: [{ path: "_to", join: "resource._id" }],
          subqueries: [{
            collection: "links_to",
            document: "lt",
            filters: [{ path: "_to", join: "rw._from" }],
            subqueries: [{
              collection: "resources",
              document: "source",
              filters: [{ path: "_id", join: "lt._from" }],
              inline: true
            }],
            inline: true
          }],
          "return": [{ path: "url", document: "source" }]
        }
      }, {
        name: "outlinks",
        function: "unique",
        query: {
          collection: "links_to",
          document: "lt",
          filters: [{ path: "_from", join: "resource._id" }],
          subqueries: [{
            collection: "unique_urls",
            document: "target",
            filters: [{ path: "_id", join: "lt._to" }],
            inline: true
          }],
          return: [{ path: "url", document: "target" }]
        }
      }],
      count: "total",
      filters: [
        { path: "code", eq: 200},
        { path: "mime", eq: "text/html" },
        { path: "parsed.subdomain", eq: "experience" },
        { path: "parsed.path[0]", eq: "resources" },
        { path: "content.language", in: [null, 'en', 'en-us', 'en-US'] },
      ],
      "sorts": [
        { path: "url", direction: "asc" }
      ],
      "return": [
        { name: "URL", path: "url" },
        { name: "Slug", path: "parsed.path[1]" },

        // Content analysis
        { name: 'Type', path: 'content.type' },
        { name: 'Language', path: 'content.language' },
        { name: 'Title', path: 'content.title' },
        { name: 'Description', path: 'content.description' },
        { name: 'Date', path: 'content.date' },
        { name: 'Words', path: 'content.readability.words' },
        { name: 'Readability', path: 'content.readability.score' },

         // Detected data
        { name: 'Cookies', path: 'cookies', function: 'length' },
        { name: 'Technologies', path: 'tech', function: 'length' },
        { name: 'Opengraph', path: 'data.meta.og', function: 'is_object' },
        { name: 'Twitter', path: 'data.meta.twitter', function: 'is_object' },
        { name: 'Schema_Org', path: 'data.schemaOrg', function: 'is_object' },
        { name: 'Load Time', path: 'timing.duration' },

        // AEM metadata
        { name: "PageID", path: "content.pageId" },
        { name: "UUID", path: "content.uuid" },
        { name: "Tags", path: "content.tags" },

        // Inlink/outlink counts
        { document: false, name: "Inlinks", path: "inlinks", function: "length" },
        { document: false, name: "Outlinks", path: "outlinks", function: "length" },
      ]
    },
  },
  reports: {
    resources: {
      name: 'Dropbox Resources',
      group: 'dropbox',
      description: 'English resource pages',
      queries: {
        'Resources': 'dropbox_resources',
      },
    },
  }
}