{
  queries: {
    dropbox_resources: {
      document: "resource",
      metadata: { category: "dropbox", description: "English resource pages" },
      collection: "resources",
      subqueries: [{
        name: "inlinks",
        function: "unique",
        query: {
          collection: "responds_with",
          document: "rw",
          filters: [{ path: "_to", join: "resource._id" }],
          subqueries: [{
            collection: "links_to",
            document: "lt",
            filters: [{ path: "_to", join: "rw._from" }],
            subqueries: [{
              collection: "resources",
              document: "source",
              filters: [{ path: "_id", join: "lt._from" }],
              inline: true
            }],
            inline: true
          }],
          "return": [{ path: "url", document: "source" }]
        }
      }, {
        name: "outlinks",
        function: "unique",
        query: {
          collection: "links_to",
          document: "lt",
          filters: [{ path: "_from", join: "resource._id" }],
          subqueries: [{
            collection: "unique_urls",
            document: "target",
            filters: [{ path: "_id", join: "lt._to" }],
            inline: true
          }],
          return: [{ path: "url", document: "target" }]
        }
      }, {
        name: "knotch",
        function: "first",
        query: {
          collection: "ds_knotch",
          filters: [{ path: "url", join: "resource.url" }],
        },
      }, {
        name: "notes",
        function: "first",
        query: {
          collection: "kv_notes",
          filters: [{ path: "val.url", join: "resource.url" }],
          return: ['val']
        },
      }, {
        name: "traffic",
        function: "first",
        query: {
          collection: "kv_traffic",
          filters: [{ path: "val.url", join: "resource.url" }],
          return: ['val']
        },
      }, {
        name: "planks",
        query: {
          collection: "appears_on",
          filters: [{ path: "_to", join: "resource._id" }]
        }
      }],
      count: "total",
      filters: [
        { path: "code", eq: 200},
        { path: "mime", eq: "text/html" },
        { path: "parsed.subdomain", eq: "experience" },
        { path: "parsed.path[0]", eq: "resources" },
        { path: "content.language", in: ['null', 'en', 'en-us', 'en-US'] },
      ],
      "sorts": [
        { path: "url", direction: "asc" }
      ],
      "return": [
        { name: "URL", path: "url" },
        { name: "Slug", path: "parsed.path[1]" },

        // Content analysis
        { name: 'Type', path: 'content.type' },
        { name: 'Language', path: 'content.language' },
        { name: 'Title', path: 'content.title' },
        { name: 'Description', path: 'content.description' },
        { name: 'Date', path: 'content.date' },
        { name: 'Words', path: 'content.readability.words' },
        { name: 'Readability', path: 'content.readability.score' },
        { name: 'Planks', document: false, path: 'planks', function: 'length' },

        // Audit data
        { name: 'Journey', document: false, path: 'notes.stage' },
        { name: 'Audience', document: false, path: 'notes.audience' },
        { name: 'PageType', document: false, path: 'notes.pageType' },
        { name: 'Industry', document: false, path: 'notes.industry' },
        { name: 'Notes', document: false, path: 'notes.notes' },
        { name: 'TotalSignups',document: false,  path: 'notes.totalSignups' },
        { name: 'TeamSignups', document: false, path: 'notes.teamSignups' },
        { name: 'ProSignups', document: false, path: 'notes.proSignups' },
        { name: 'PlusSignups', document: false, path: 'notes.plusSignups' },
        { name: 'Views', document: false, path: 'traffic.views' },
        { name: 'Sessions', document: false, path: 'traffic.sessions' },
        { name: 'ExitRate', document: false, path: 'traffic.exit' },
        { name: 'BounceRate', document: false, path: 'traffic.bounce' },

        // Knotch DataView
        { name: 'Perceive', document: false, path: 'knotch.perception.positiveResponseRate' },
        { name: 'Recommend', document: false, path: 'knotch.recommend.positiveResponseRate' },
        { name: 'Inform', document: false, path: 'knotch.inform.positiveResponseRate' },

         // Detected data
        { name: 'Cookies', path: 'cookies', function: 'length' },
        { name: 'Technologies', path: 'tech', function: 'length' },
        { name: 'Opengraph', path: 'data.meta.og', function: 'is_object' },
        { name: 'Twitter', path: 'data.meta.twitter', function: 'is_object' },
        { name: 'Schema_Org', path: 'data.schemaOrg', function: 'is_object' },
        { name: 'Pagespeed', path: 'pagespeed.overall' },
        { name: 'Load Time', path: 'pagespeed.speedIndex' },
        { name: 'Perf', path: 'pagespeed.performance' },
        { name: 'SEO', path: 'pagespeed.seo' },

        // AEM metadata
        { name: "PageID", path: "content.pageId" },
        { name: "UUID", path: "content.uuid" },
        { name: "Tags", path: "content.tags" },

        // Inlink/outlink counts
        { document: false, name: "Inlinks", path: "inlinks", function: "length" },
        { document: false, name: "Outlinks", path: "outlinks", function: "length" },
      ]
    },
  },
  reports: {
    resources: {
      name: 'Dropbox Resources',
      group: 'dropbox',
      description: 'English resource pages',
      queries: {
        'Resources': 'dropbox_resources',
      },
    },
  }
}